<!DOCTYPE html>
<html>
	<head>
		<style>
			body{
				background-color:#ffe;
			}
			ul{
				list-style-type:none;
				float:left;
			}
			#data{
				float:left;
				padding:10px;
				background-color:#aa9;
			}
			#ambient{
				float:left;
				padding:10px;
				background-color:#aae;
				position:fixed;
				margin-left:70%;
			}
			#controle{
				position:fixed;
				margin-left:20%;
			}
			#tela{
				position:fixed;
				margin-left:10%;
				margin-top:5%;
			}
		</style>
		
	</head>
	<body>
		<div id="data"></div>
		<div id="ambient"></div>
		<div style="position:fixed;margin-left:70%;margin-top:30%;">
			<form action="javascript:;">
				<ul>
						<li>Input</li>
						<li>temperature <input value="" id="temperature" size="3"></li>
						<li>water <input value="" id="water" size="3"></li>
						<li>sunlight<input value="" id="sunlight" size="3"></li>
						<li>nutrient<input value="" id="nutrient" size="3"></li>
						<li>beneficialairinsect<input value="" id="beneficialairinsect" size="3"></li>
						<li>beneficialearthinsect<input value="" id="beneficialearthinsect" size="3"></li>
						<input type="button" onclick="insert()" value="Update"/>
					</ul>
			</form>
		</div>
		<div id="controle">
			<input onclick="atualizar(1)" value="Evoluir" type="button"/>
			<input onclick="atualizar(10)" value="Evoluir 10x" type="button"/>
			<input onclick="atualizar(100)" value="Evoluir 100x" type="button"/>
			<input onclick="atualizar(1000)" value="Evoluir 1000x" type="button"/>
		</div>
		<canvas id="tela" style="border: 1px solid;" width="520" height="450" onclick="atualizar(event)"></canvas>
		<script src="ai_algorithm_genetic.js"></script>
		<script>
			//alert(ai.getNumFlowers());
			/* CANVAS */
			var canvas = document.getElementById('tela');
			var context = canvas.getContext('2d');
			
			// moscas - beneficial insects air
			var moscas = new Array();
			moscas[0] = new Array(); // x
			moscas[1] = new Array(); // y
			for(var i=0;i<ai.currentbeneficialairinsect;i++){
				moscas[0][i]=parseInt((Math.random()*1000)%520);
				moscas[1][i]=parseInt((Math.random()*1000)%50)+150;
			}
			// formigas - beneficial insects eart
			var formigas = new Array();
			formigas[0] = new Array(); // x
			formigas[1] = new Array(); // y
			for(var i=0;i<ai.currentbeneficialearthinsect;i++){
				formigas[0][i]=parseInt((Math.random()*1000)%520);
				formigas[1][i]=parseInt((Math.random()*1000)%50)+350;
			}
			
			// outros
			var terreno = parseInt(ai.currentNutrient/4); if(terreno==16){terreno=14};
			var sol = 12+parseInt(ai.currentSunlight/20);
			var temperatura = 12+parseInt(ai.currentTemperature/20);
			
			// Torna possivel a atualizacao por meio da entrada do usuario
			function changeAttr(){
				// moscas - beneficial insects air
				moscas = new Array();
				moscas[0] = new Array(); // x
				moscas[1] = new Array(); // y
				for(var i=0;i<ai.currentbeneficialairinsect;i++){
					moscas[0][i]=parseInt((Math.random()*1000)%520);
					moscas[1][i]=parseInt((Math.random()*1000)%50)+150;
				}
				// formigas - beneficial insects eart
				formigas = new Array();
				formigas[0] = new Array(); // x
				formigas[1] = new Array(); // y
				for(var i=0;i<ai.currentbeneficialearthinsect;i++){
					formigas[0][i]=parseInt((Math.random()*1000)%520);
					formigas[1][i]=parseInt((Math.random()*1000)%50)+350;
				}
				
				// outros
				terreno = parseInt(ai.currentNutrient/4); if(terreno==16){terreno=14};
				sol = 12+parseInt(ai.currentSunlight/20);
				temperatura = 12+parseInt(ai.currentTemperature/20);
			}
			
			function hexadecimal(num, point){
				var n = '#';// = num%16;
				var vet = new Array(), quociente = num, resto;
				for(var i=point;i>=0;i--){
					//vet[i]=0;
					resto=quociente%16;
					if((parseInt(quociente/16)>quociente/16))
						quociente=parseInt(quociente/16)-1;
					else
						quociente=parseInt(quociente/16);
					//console.log("i: "+i+", quociente: "+quociente);
					//quociente=min(parseInt(quociente/16),quociente/16);
					switch(resto){
						case 10:
							vet[i]='a';
							break;
						case 11:
							vet[i]="b";
							break;
						case 12:
							vet[i]="c";
							break;
						case 13:
							vet[i]="d";
							break;
						case 14:
							vet[i]="e";
							break;
						case 15:
							vet[i]="f";
							break;
						case 16:
							vet[i]="0";
							break;
						case 0:
							if(quociente==1)
								vet[i]=resto;
							else
								vet[i]="0";
							break;
						default:
								vet[i]=resto;
					}
				}
				for(var i=0;i<vet.length;i++)
					n+=vet[i];
					
				return n;
			}
			
			function flower(){
				// caule
				context.lineWidth = 4;
				context.lineJoin = 'round';
				context.strokeStyle = '#552200';
				
				for(var i=0;i<ai.getNumFlowers();i++){
					var terrenoF = parseInt(ai.nutrient[i]/4); if(terrenoF==16){terrenoF=14};
					context.beginPath();
					context.strokeStyle = hexadecimal((256*(terrenoF+2)*17+terrenoF*17)*256,5);
					context.moveTo(20+i*(520/ai.getNumFlowers()), 380);
					context.lineTo(20+i*(520/ai.getNumFlowers()), 300-(ai.beneficialairinsect[i]-ai.beneficialearthinsect[i]));
					context.stroke();
					context.closePath();
					
					// floral
					context.beginPath();
					var solF = 12+parseInt(ai.sunlight[i]/20);
					var temperaturaF = 12+parseInt(ai.temperature[i]/20);
					context.strokeStyle = hexadecimal(solF*256*(256*16+256+17),5);//hexadecimal(16*parseInt(200+ai.currentSunlight),2);// hexadecimal(((257)*(15)*17)*256,5)
					context.fillStyle = hexadecimal(temperaturaF*256*(256*16+256+17),5);
					context.arc(20+i*(520/ai.getNumFlowers()), 300-(ai.beneficialairinsect[i]-ai.beneficialearthinsect[i]), 5+ai.water[i]/4, 0, (Math.PI/180)*360, true);
					context.fill();
					context.stroke();
					context.closePath();
				}
			}
			
			function draw(){
				// fundo
				context.fillStyle = "#cfdffe";
				context.fillRect(0, 0, 520, 450);
				
				// terreno
				context.lineWidth = 4;
				context.lineJoin = 'round';
				context.strokeStyle = '#552200';
				
				context.beginPath();
				context.moveTo(0, 380);
				context.lineTo(520, 380);
				context.stroke();
				context.closePath();
				context.fillStyle = hexadecimal((256*(terreno+2)*17+terreno*17)*256,5);//"#220000";
				context.fillRect(0, 380, 520, 380);	
				
				// sol
				context.beginPath();
				context.strokeStyle = hexadecimal(sol*256*(256*16+256+17),5);//hexadecimal(16*parseInt(200+ai.currentSunlight),2);// hexadecimal(((257)*(15)*17)*256,5)
				context.fillStyle = hexadecimal(temperatura*256*(256*16+256+17),5);
				context.arc(100, 100, 20, 0, (Math.PI/180)*360, true);
				context.fill();
				context.stroke();
				context.closePath();
				
				// nuvem
				context.beginPath();
				context.fillStyle="#fff";
				context.strokeStyle = "#fff";
				context.arc(260, 105, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);
				context.arc(250, 100, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);
				context.arc(280, 100, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);
				context.arc(260, 80, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);

				context.arc(290, 105, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);
				context.arc(280, 100, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);
				context.arc(310, 100, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);
				context.arc(290, 80, 15.5+ai.currentWater/4, 0, (Math.PI/180)*360, true);				
				context.fill();
				context.closePath();
				
				// moscas - beneficial insects
				for(var i=0;i<ai.currentbeneficialairinsect;i++){
					moscas[0][i]+=(Math.random()-0.5)*3;
					moscas[1][i]+=(Math.random()-0.5)*3;
					if(moscas[0][i]>520)
						moscas[0][i]=520;
					else if(moscas[0][i]<0)
						moscas[0][i]=0;
					if(moscas[1][i]>320)
						moscas[1][i]=320;
					else if(moscas[1][i]<0)
						moscas[1][i]=0;
						
					context.beginPath();
					context.fillStyle="#000";
					context.strokeStyle = "#000";
					context.arc(moscas[0][i], moscas[1][i], 2, 0, (Math.PI/180)*360, true);
					context.fill();
					context.closePath();
				}
				// formigas - currentbeneficialearthinsect
				for(var i=0;i<ai.currentbeneficialearthinsect;i++){
					formigas[0][i]+=(Math.random()-0.5)*3;
					formigas[1][i]+=(Math.random()-0.5)*3;
					if(formigas[0][i]>520)
						formigas[0][i]=520;
					else if(formigas[0][i]<0)
						formigas[0][i]=0;
					if(formigas[1][i]>450)
						formigas[1][i]=450;
					else if(formigas[1][i]<380)
						formigas[1][i]=380;
						
					context.beginPath();
					context.fillStyle="#f55";
					context.strokeStyle = "#000";
					context.arc(formigas[0][i], formigas[1][i], 2, 0, (Math.PI/180)*360, true);
					context.fill();
					context.closePath();
				}
				flower();
			}
			
			
				var elements = new Array();
				elements[0] = document.getElementById("temperature");
				elements[1] = document.getElementById("water");
				elements[2] = document.getElementById("sunlight");
				elements[3] = document.getElementById("nutrient");
				elements[4] = document.getElementById("beneficialairinsect");
				elements[5] = document.getElementById("beneficialearthinsect");
				
			function insert(){
				if(elements[0].value!="")
					ai.currentTemperature=elements[0].value;
				if(elements[1].value!="")
					ai.currentWater=elements[1].value;
				if(elements[2].value!="")
					ai.currentSunlight=elements[2].value;
				if(elements[3].value!="")
					ai.currentNutrient=elements[3].value;
				if(elements[4].value!="")
					ai.currentbeneficialairinsect=elements[4].value;
				if(elements[5].value!="")
					ai.currentbeneficialearthinsect=elements[5].value;
				
				changeAttr();
			}
			
			setInterval(draw, 100);
		</script>
	</body>
</html>